From fa86c2e3f919e9d1548e57f56525e7c310f94fe4 Mon Sep 17 00:00:00 2001
From: Mika Laitio <mika.laitio@amd.com>
Date: Wed, 3 Sep 2025 00:52:41 -0700
Subject: [PATCH 1/3] rdma link agains static libgtest.a

Signed-off-by: Mika Laitio <mika.laitio@amd.com>
---
 rdma/MakefileHip | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/rdma/MakefileHip b/rdma/MakefileHip
index 2df2dac..7531005 100644
--- a/rdma/MakefileHip
+++ b/rdma/MakefileHip
@@ -1,12 +1,14 @@
 ABS_ROOT_PATH := $(shell dirname $(realpath $(lastword $(MAKEFILE_LIST))))
 
+$(info MakefileHip. make=$(MAKE), cc=$(CC))
+
 RCCL_HOME:=../thirdparty/rccl
 HIP_HOME?=/opt/rocm
 CONDA_LIB_HOME?=/usr/lib
 
 INC = -I./ -I../include -I$(HIP_HOME)/include -I${CONDA_LIB_HOME}/../include -L${CONDA_LIB_HOME}
-LIBS = -lglog -lgflags -lgtest -lz -lelf -libverbs -L ${HIP_HOME}/lib -lamdhip64
-LIBS_SHARED = -lglog -lgflags -lgtest -lz -lelf -libverbs
+LIBS = -lglog -lgflags -l:libgtest.a -lz -lelf -libverbs -L ${HIP_HOME}/lib -lamdhip64 -L ${HIP_HOME}/../../third-party/googletest/dist/lib
+LIBS_SHARED = -lglog -lgflags -lz -lelf -libverbs
 override CXXFLAGS += -O3 -g -std=c++17 -Wno-pointer-arith -Wno-interference-size -fPIC -D__HIP_PLATFORM_AMD__
 DEPS = *.h
 PLUGIN_SO = librccl-net-uccl.so
-- 
2.43.0

