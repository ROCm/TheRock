From 57920ad27347711d86680ddfd1055eba56571ef0 Mon Sep 17 00:00:00 2001
From: Scott Todd <scott.todd0@gmail.com>
Date: Fri, 25 Jul 2025 15:33:42 -0700
Subject: [PATCH 4/4] Move rocblas include to fix Windows builds.

---
 aten/src/ATen/hip/CublasHandlePool.cpp | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/aten/src/ATen/hip/CublasHandlePool.cpp b/aten/src/ATen/hip/CublasHandlePool.cpp
index 3a77fe70477..106735158f4 100644
--- a/aten/src/ATen/hip/CublasHandlePool.cpp
+++ b/aten/src/ATen/hip/CublasHandlePool.cpp
@@ -11,6 +11,11 @@
 #include <string>
 #include <tuple>
 
+// ugly hack until hipblasSetWorkspace exists
+#if defined(USE_ROCM)
+#include <rocblas/rocblas.h>
+#endif
+
 /**
  * Note [hipblaslt handles]
  * ~~~~~~~~~~~~~~~~~~~~~~~~
@@ -53,9 +58,6 @@ void destroyCublasLtHandle(hipblasLtHandle_t handle) {
 
 using CuBlasLtPoolType = DeviceThreadHandlePool<hipblasLtHandle_t, createCublasLtHandle, destroyCublasLtHandle>;
 
-// ugly hack until hipblasSetWorkspace exists
-#include <rocblas/rocblas.h>
-
 static hipblasStatus_t rocBLASStatusToHIPStatus(rocblas_status error) {
     switch(error) {
     case rocblas_status_size_unchanged:
-- 
2.47.1.windows.2

