From 1ad55ad3946fdfa54824bda3b821833083773582 Mon Sep 17 00:00:00 2001
From: Aaryaman Vasishta <aaryaman.vasishta@amd.com>
Date: Tue, 2 Sep 2025 17:07:09 +0900
Subject: [PATCH] Support getrsBatched/geqrfBatched/gelsBatched on Windows ROCm

---
 aten/src/ATen/cuda/CUDABlas.cpp |  3 ---
 aten/src/ATen/cuda/CUDABlas.h   | 27 ---------------------------
 2 files changed, 30 deletions(-)

diff --git a/aten/src/ATen/cuda/CUDABlas.cpp b/aten/src/ATen/cuda/CUDABlas.cpp
index 4ab57f0beb..4f64318fa4 100644
--- a/aten/src/ATen/cuda/CUDABlas.cpp
+++ b/aten/src/ATen/cuda/CUDABlas.cpp
@@ -2583,8 +2583,6 @@ void vdot<c10::complex<double>>(CUDABLAS_DOT_ARGTYPES(c10::complex<double>)) {
                                    reinterpret_cast<cuDoubleComplex*>(result)));
 }
 
-// HIP on Windows does not support
-#if !(defined(USE_ROCM) && defined(_MSC_VER))
 template <>
 void getrsBatched<float>(CUDABLAS_GETRS_ARGTYPES(float)) {
   TORCH_CUDABLAS_CHECK(cublasSgetrsBatched(
@@ -2783,6 +2781,5 @@ void gelsBatched<c10::complex<float>>(CUDABLAS_GELS_BATCHED_ARGTYPES(c10::comple
       devInfoArray,
       batchSize));
 }
-#endif // !(defined(USE_ROCM) && defined(_MSC_VER))
 
 } // namespace at::cuda::blas
diff --git a/aten/src/ATen/cuda/CUDABlas.h b/aten/src/ATen/cuda/CUDABlas.h
index 5021917fe0..b235840418 100644
--- a/aten/src/ATen/cuda/CUDABlas.h
+++ b/aten/src/ATen/cuda/CUDABlas.h
@@ -343,9 +343,6 @@ void vdot<c10::complex<double>>(CUDABLAS_DOT_ARGTYPES(c10::complex<double>));
   int m, int n, int nrhs, Dtype** dA_array, int ldda, \
   Dtype** dC_array, int lddc, int* info, int *devInfoArray, int batchSize
 
-// HIP on Windows does not support getrs, geqrf, getrf, gels
-#if !(defined(USE_ROCM) && defined(_MSC_VER))
-
 template<class Dtype>
 void getrsBatched(CUDABLAS_GETRS_ARGTYPES(Dtype)) {
   static_assert(false&&sizeof(Dtype),"at::cuda::blas::getrsBatched: not implemented");
@@ -400,28 +397,4 @@ TORCH_CUDA_CU_API void gelsBatched<c10::complex<double>>(CUDABLAS_GELS_BATCHED_A
 template<>
 TORCH_CUDA_CU_API void gelsBatched<c10::complex<float>>(CUDABLAS_GELS_BATCHED_ARGTYPES(c10::complex<float>));
 
-#else // !(defined(USE_ROCM) && defined(_MSC_VER))
-
-template<class Dtype>
-void getrsBatched(CUDABLAS_GETRS_ARGTYPES(Dtype)) {
-  TORCH_CHECK(false, "at::cuda::blas::getrsBatched: not supported for HIP on Windows");
-}
-
-template <class Dtype>
-void geqrfBatched(CUDABLAS_GEQRF_BATCHED_ARGTYPES(Dtype)) {
-  TORCH_CHECK(false, "at::cuda::blas::geqrfBatched: not supported for HIP on Windows");
-}
-
-template<class Dtype>
-void getrfBatched(CUDABLAS_GETRF_ARGTYPES(Dtype)) {
-  TORCH_CHECK(false, "at::cuda::blas::getrfBatched: not supported for HIP on Windows");
-}
-
-template <class Dtype>
-void gelsBatched(CUDABLAS_GELS_BATCHED_ARGTYPES(Dtype)) {
-  TORCH_CHECK(false, "at::cuda::blas::gelsBatched: not supported for HIP on Windows");
-}
-
-#endif // !(defined(USE_ROCM) && defined(_MSC_VER))
-
 } // namespace at::cuda::blas
-- 
2.50.1.windows.1

