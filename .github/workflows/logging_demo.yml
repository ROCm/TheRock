name: Logging Framework Demo

# Demo workflow for TheRock standardized logging framework
# Demonstrates five sample applications using the unified logging framework:
# 1. Package Installer
# 2. Build System
# 3. GTest Runner
# 4. rocROLLER GTest Integration (Mock)
# 5. rocWMMA CTest Integration (Mock)
on:
  # Manual trigger
  workflow_dispatch:
  
  # Auto-trigger on push
  push:
    branches:
      - 'users/rponnuru/logging_poc_2'

permissions:
  contents: read

jobs:
  logging_demo:
    name: Logging Framework Demo
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name: Display Demo Info
        run: |
          echo "=========================================="
          echo "  TheRock Logging Framework Demo"
          echo "=========================================="
          echo ""
          echo "Trigger: ${{ github.event_name }}"
          echo "Branch: ${{ github.ref_name }}"
          echo "Demos: Package Installer + Build System + GTest + rocROLLER + rocWMMA"
          echo ""
      
      - name: üìã Run Logging Framework Demo
        run: |
          echo "::group::üìù Running Logging Framework Demo"
          echo "=========================================="
          echo "  TheRock Unified Logging Framework"
          echo "  Sample 1: Package Installer"
          echo "  Sample 2: Build System"
          echo "  Sample 3: GTest Runner"
          echo "=========================================="
          echo ""
          
          cd build_tools/_therock_utils
          python3 run_logging_demos.py
          
          echo ""
          echo "‚úÖ All demos completed!"
          echo "::endgroup::"
      
      - name: üß™ Run Mock rocROLLER GTest Demo
        run: |
          echo "::group::üß™ rocROLLER GTest Demo (Mock)"
          echo "=========================================="
          echo "  Demonstrating GTest Integration"
          echo "  with Unified Logging Framework"
          echo "=========================================="
          echo ""
          
          cd build_tools/github_actions/test_executable_scripts
          python3 demo_test_rocroller.py
          
          echo ""
          echo "‚úÖ rocROLLER demo completed!"
          echo "::endgroup::"
        env:
          TEST_TYPE: smoke
          SHARD_INDEX: 1
          TOTAL_SHARDS: 1
          RUNNER_OS: Linux
      
      - name: üî¨ Run Mock rocWMMA CTest Demo
        run: |
          echo "::group::üî¨ rocWMMA CTest Demo (Mock)"
          echo "=========================================="
          echo "  Demonstrating CTest Integration"
          echo "  with Unified Logging Framework"
          echo "=========================================="
          echo ""
          
          cd build_tools/github_actions/test_executable_scripts
          python3 demo_test_rocwmma.py
          
          echo ""
          echo "‚úÖ rocWMMA demo completed!"
          echo "::endgroup::"
        env:
          TEST_TYPE: regression
          SHARD_INDEX: 1
          TOTAL_SHARDS: 1
          AMDGPU_FAMILIES: gfx942
          RUNNER_OS: Linux
      
      - name: ‚úÖ Demo Summary
        if: always()
        run: |
          echo ""
          echo "=========================================="
          echo "  Demo Summary"
          echo "=========================================="
          echo ""
          echo "Samples Run:"
          echo "  1. Package Installer (install & verify)"
          echo "  2. Build System (configure, compile & test)"
          echo "  3. GTest Runner (execute, parse & filter)"
          echo "  4. rocROLLER GTest Demo (mock GPU tests)"
          echo "  5. rocWMMA CTest Demo (mock GPU tests)"
          echo ""
          echo "Status: ${{ job.status }}"
          echo ""
          echo "‚úÖ Logging framework demo completed!"
          echo ""
          echo "Key Features Demonstrated:"
          echo "  - Unified logging across all components"
          echo "  - Structured logging with extra fields"
          echo "  - Automatic timing with timed_operation"
          echo "  - Exception handling with log_exception"
          echo "  - GTest integration and result parsing"
          echo "  - CTest integration with sharding"
          echo "  - Test filtering (smoke/regression/full)"
          echo "  - Performance metrics tracking"
          echo ""


