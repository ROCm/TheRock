From f8490b69a3722bfa7a0304145d4c53027b523513 Mon Sep 17 00:00:00 2001
From: Stella Laurenzo <stellaraccident@gmail.com>
Date: Mon, 3 Feb 2025 19:14:24 -0800
Subject: [PATCH] HACK: Disable incorrect roctracer dependency.

---
 library/CMakeLists.txt  |  6 +++---
 library/src/logging.cpp | 11 ++++++++---
 2 files changed, 11 insertions(+), 6 deletions(-)

diff --git a/library/CMakeLists.txt b/library/CMakeLists.txt
index 8cd2bd51..0c0f8460 100644
--- a/library/CMakeLists.txt
+++ b/library/CMakeLists.txt
@@ -80,9 +80,9 @@ function( rocblas_library_settings lib_target_ )
     target_link_libraries( ${lib_target_} PRIVATE hip::device )
   else()
     target_link_libraries( ${lib_target_} PRIVATE hip::device -lstdc++fs --rtlib=compiler-rt --unwindlib=libgcc)
-    if (BUILD_SHARED_LIBS)
-      target_link_libraries(${lib_target_} PRIVATE -lroctx64)
-    endif()
+    # if (BUILD_SHARED_LIBS)
+    #   target_link_libraries(${lib_target_} PRIVATE -lroctx64)
+    # endif()
   endif()
     target_link_libraries( ${lib_target_} PRIVATE Threads::Threads )
   #  -fno-gpu-rdc compiler option was used with hcc, so revisit feature at some point
diff --git a/library/src/logging.cpp b/library/src/logging.cpp
index 737f30d1..27ef9327 100644
--- a/library/src/logging.cpp
+++ b/library/src/logging.cpp
@@ -1,6 +1,9 @@
 #include <limits>
 
-#if !defined(ROCBLAS_STATIC_LIB) && !defined(WIN32)
+#define ROCBLAS_USE_ROCTRACER 0
+
+// #if !defined(ROCBLAS_STATIC_LIB) && !defined(WIN32)
+#if ROCBLAS_USE_ROCTRACER
 #include <roctracer/roctx.h>
 #endif
 
@@ -126,7 +129,8 @@ const char* c_rocblas_internal = "rocblas_internal";
 
 void rocblas_internal_logger::log_endline(rocblas_internal_ostream& os)
 {
-#if !defined(ROCBLAS_STATIC_LIB) && !defined(WIN32)
+//#if !defined(ROCBLAS_STATIC_LIB) && !defined(WIN32)
+#if ROCBLAS_USE_ROCTRACER
     if(!m_active)
     {
         const std::string& name = os.str();
@@ -139,7 +143,8 @@ void rocblas_internal_logger::log_endline(rocblas_internal_ostream& os)
 
 void rocblas_internal_logger::log_cleanup()
 {
-#if !defined(ROCBLAS_STATIC_LIB) && !defined(WIN32)
+//#if !defined(ROCBLAS_STATIC_LIB) && !defined(WIN32)
+#if ROCBLAS_USE_ROCTRACER
     roctxRangePop();
 #endif
 }
-- 
2.43.0

