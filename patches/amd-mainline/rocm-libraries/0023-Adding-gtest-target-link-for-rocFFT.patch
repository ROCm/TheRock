From 51c4addeb6e94cbe9fb9affaa3452847299192f6 Mon Sep 17 00:00:00 2001
From: geomin12 <geomin12@amd.com>
Date: Wed, 20 Aug 2025 10:15:52 -0700
Subject: [PATCH 23/24] Adding gtest target link for rocFFT

Co-authored-by: Mika Laitio <mika.laitio@amd.com>
Signed-off-by: geomin12 <geomin12@amd.com>
---
 .../rocfft/clients/cmake/build-gtest.cmake    | 48 -------------------
 projects/rocfft/clients/tests/CMakeLists.txt  | 12 +----
 2 files changed, 2 insertions(+), 58 deletions(-)
 delete mode 100644 projects/rocfft/clients/cmake/build-gtest.cmake

diff --git a/projects/rocfft/clients/cmake/build-gtest.cmake b/projects/rocfft/clients/cmake/build-gtest.cmake
deleted file mode 100644
index 441eca65d3..0000000000
--- a/projects/rocfft/clients/cmake/build-gtest.cmake
+++ /dev/null
@@ -1,48 +0,0 @@
-# Copyright (C) 2021 - 2022 Advanced Micro Devices, Inc. All rights reserved.
-#
-# Permission is hereby granted, free of charge, to any person obtaining a copy
-# of this software and associated documentation files (the "Software"), to deal
-# in the Software without restriction, including without limitation the rights
-# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
-# copies of the Software, and to permit persons to whom the Software is
-# furnished to do so, subject to the following conditions:
-#
-# The above copyright notice and this permission notice shall be included in
-# all copies or substantial portions of the Software.
-#
-# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
-# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
-# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
-# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
-# THE SOFTWARE.
-
-include( ExternalProject )
-
-option( BUILD_GTEST "Download and build GoogleTest" OFF )
-
-if( NOT BUILD_GTEST )
-    find_package( GTest 1.11.0 )
-endif()
-
-if( (BUILD_GTEST OR NOT GTEST_FOUND) AND (NOT TARGET gtest) )
-  set(GTEST_INCLUDE_DIRS
-      ${CMAKE_CURRENT_BINARY_DIR}/src/gtest/googletest/include)
-  set(GTEST_LIBRARIES
-      ${CMAKE_CURRENT_BINARY_DIR}/src/gtest-build/lib/${CMAKE_STATIC_LIBRARY_PREFIX}gtest${CMAKE_STATIC_LIBRARY_SUFFIX}
-      ${CMAKE_CURRENT_BINARY_DIR}/src/gtest-build/lib/${CMAKE_STATIC_LIBRARY_PREFIX}gtest_main${CMAKE_STATIC_LIBRARY_SUFFIX})
-  
-  set(GTEST_SRC_URL https://github.com/google/googletest/archive/release-1.11.0.tar.gz CACHE STRING "Location of GTest source code")
-  set(GTEST_SRC_SHA256 b4870bf121ff7795ba20d20bcdd8627b8e088f2d1dab299a031c1034eddc93d5 CACHE STRING "SHA256 hash of GTest source code")
-  
-  ExternalProject_Add(gtest
-                      URL ${GTEST_SRC_URL}
-                      URL_HASH SHA256=${GTEST_SRC_SHA256}
-                      PREFIX ${CMAKE_CURRENT_BINARY_DIR}
-                      CMAKE_ARGS -DCMAKE_CXX_COMPILER_LAUNCHER=${CMAKE_CXX_COMPILER_LAUNCHER}
-                      INSTALL_COMMAND ""
-                      BUILD_BYPRODUCTS ${GTEST_LIBRARIES})
-  ExternalProject_Get_Property( gtest source_dir binary_dir )  
-endif()
-
diff --git a/projects/rocfft/clients/tests/CMakeLists.txt b/projects/rocfft/clients/tests/CMakeLists.txt
index 81282b237e..79d371b2c5 100644
--- a/projects/rocfft/clients/tests/CMakeLists.txt
+++ b/projects/rocfft/clients/tests/CMakeLists.txt
@@ -189,16 +189,8 @@ set( rocfft-test_link_libs
   FFTW3::fftw3 FFTW3::fftw3f OpenMP::OpenMP_CXX
   )
 
-include( ../cmake/build-gtest.cmake )
-
-if( BUILD_GTEST OR NOT GTEST_FOUND )
-  add_dependencies( rocfft-test gtest )
-  list( APPEND rocfft-test_include_dirs ${GTEST_INCLUDE_DIRS} )
-  list( APPEND rocfft-test_link_libs ${GTEST_LIBRARIES} )
-else()  
-  list( APPEND rocfft-test_include_dirs $<BUILD_INTERFACE:${GTEST_INCLUDE_DIRS}> )
-  list( APPEND rocfft-test_link_libs ${GTEST_LIBRARIES} )
-endif()
+find_package( GTest REQUIRED)
+target_link_libraries( rocfft-test PRIVATE GTest::gtest)
 
 target_compile_options( rocfft-test PRIVATE ${WARNING_FLAGS} -Wno-cpp )
 
-- 
2.34.1

