From 5900330d896d2691c87b27aa0e939e9979048f6b Mon Sep 17 00:00:00 2001
From: Bain Syrowik <bain.syrowik@amd.com>
Date: Fri, 24 Oct 2025 18:49:28 -0400
Subject: [PATCH 5/5] Create additional CTest files for smoke and regression
 tests

---
 test/CMakeLists.txt | 33 +++++++++++++++++++++++++++++++++
 1 file changed, 33 insertions(+)

diff --git a/test/CMakeLists.txt b/test/CMakeLists.txt
index f597a423..0acdaa69 100644
--- a/test/CMakeLists.txt
+++ b/test/CMakeLists.txt
@@ -85,6 +85,21 @@ file(WRITE "${INSTALL_TEST_FILE}"
 # It differs slightly from the default testfile, and you may encounter issues because of that.
 ]=]
 )
+set(INSTALL_SMOKE_TEST_FILE "${CMAKE_CURRENT_BINARY_DIR}/install_smoke_CTestTestfile.cmake")
+file(WRITE "${INSTALL_SMOKE_TEST_FILE}"
+[=[
+# This is a test file generated by rocWMMA for install time.
+# It differs slightly from the default testfile, and you may encounter issues because of that.
+]=]
+)
+set(INSTALL_REGRESSION_TEST_FILE "${CMAKE_CURRENT_BINARY_DIR}/install_regression_CTestTestfile.cmake")
+file(WRITE "${INSTALL_SMOKE_TEST_FILE}"
+[=[
+# This is a test file generated by rocWMMA for install time.
+# It differs slightly from the default testfile, and you may encounter issues because of that.
+]=]
+)
+
 
 # Regular gtests that don't require any special
 # designation for validation or benchmarking
@@ -144,6 +159,12 @@ function(add_rocwmma_test TEST_TARGET TEST_SOURCE)
   endif()
   file(APPEND "${INSTALL_TEST_FILE}" "add_test(${TEST_TARGET} \"../${EXE_NAME}\")\n")
   file(APPEND "${INSTALL_TEST_FILE}" "set_tests_properties(${TEST_TARGET} PROPERTIES SKIP_REGULAR_EXPRESSION \"no ROCm-capable device;unsupported host device\")\n")
+
+  file(APPEND "${INSTALL_SMOKE_TEST_FILE}" "add_test(\"${TEST_TARGET} smoke\" \"../../${EXE_NAME}\" --emulation smoke)\n")
+  file(APPEND "${INSTALL_SMOKE_TEST_FILE}" "set_tests_properties(\"${TEST_TARGET} smoke\" PROPERTIES SKIP_REGULAR_EXPRESSION \"no ROCm-capable device;unsupported host device\")\n")
+
+  file(APPEND "${INSTALL_REGRESSION_TEST_FILE}" "add_test(\"${TEST_TARGET} regression\" \"../../${EXE_NAME}\" --emulation regression)\n")
+  file(APPEND "${INSTALL_REGRESSION_TEST_FILE}" "set_tests_properties(\"${TEST_TARGET} regression\" PROPERTIES SKIP_REGULAR_EXPRESSION \"no ROCm-capable device;unsupported host device\")\n")
 endfunction()
 
 # Targets that implement specifically validation configuration
@@ -170,3 +191,15 @@ rocm_install(
     COMPONENT tests
     RENAME "CTestTestfile.cmake"
 )
+rocm_install(
+    FILES "${INSTALL_SMOKE_TEST_FILE}"
+    DESTINATION "${CMAKE_INSTALL_BINDIR}/${PROJECT_NAME}/smoke"
+    COMPONENT tests
+    RENAME "CTestTestfile.cmake"
+)
+rocm_install(
+    FILES "${INSTALL_REGRESSION_TEST_FILE}"
+    DESTINATION "${CMAKE_INSTALL_BINDIR}/${PROJECT_NAME}/regression"
+    COMPONENT tests
+    RENAME "CTestTestfile.cmake"
+)
-- 
2.43.0

